#!/bin/bash

# Colors
GREEN='\033[0;32m'
CYAN='\033[0;36m'
BOLD='\033[1m'
DIM='\033[2m'
NC='\033[0m'

# Auto-detect script location and derive INSTALL_DIR
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
INSTALL_DIR="${SCRIPT_DIR}/../binary-files"
# Normalize path (resolve ../)
INSTALL_DIR="$(cd "$INSTALL_DIR" 2>/dev/null && pwd || echo "$INSTALL_DIR")"
ARCH=$(uname -m)

# Determine arch labels
case "$ARCH" in
    arm64|aarch64)
        ARCH_LABEL="Apple Silicon (arm64)"
        FZF_FILE="fzf-VERSION-darwin_arm64.zip"
        RG_FILE="ripgrep-VERSION-aarch64-apple-darwin.tar.gz"
        FD_FILE="fd-vVERSION-aarch64-apple-darwin.tar.gz"
        BAT_FILE="bat-vVERSION-aarch64-apple-darwin.tar.gz"
        LAZYGIT_FILE="lazygit_VERSION_Darwin_arm64.tar.gz"
        LAZYDOCKER_FILE="lazydocker_VERSION_Darwin_arm64.tar.gz"
        FX_FILE="fx_darwin_arm64"
        GRON_FILE="gron-darwin-arm64-VERSION.tgz"
        DELTA_FILE="delta-VERSION-aarch64-apple-darwin.tar.gz"
        LSD_FILE="lsd-vVERSION-aarch64-apple-darwin.tar.gz"
        STARSHIP_FILE="starship-aarch64-apple-darwin.tar.gz"
        ZOXIDE_FILE="zoxide-VERSION-aarch64-apple-darwin.tar.gz"
        DUST_FILE="dust-vVERSION-aarch64-apple-darwin.tar.gz"
        DUF_FILE="duf_VERSION_darwin_arm64.tar.gz"
        BTM_FILE="bottom_aarch64-apple-darwin.tar.gz"
        JQ_FILE="jq-macos-arm64"
        CURLIE_FILE="curlie_VERSION_darwin_arm64.tar.gz"
        ;;
    x86_64)
        ARCH_LABEL="Intel (x86_64)"
        FZF_FILE="fzf-VERSION-darwin_amd64.zip"
        RG_FILE="ripgrep-VERSION-x86_64-apple-darwin.tar.gz"
        FD_FILE="fd-vVERSION-x86_64-apple-darwin.tar.gz"
        BAT_FILE="bat-vVERSION-x86_64-apple-darwin.tar.gz"
        LAZYGIT_FILE="lazygit_VERSION_Darwin_x86_64.tar.gz"
        LAZYDOCKER_FILE="lazydocker_VERSION_Darwin_x86_64.tar.gz"
        FX_FILE="fx_darwin_amd64"
        GRON_FILE="gron-darwin-amd64-VERSION.tgz"
        DELTA_FILE="delta-VERSION-x86_64-apple-darwin.tar.gz"
        LSD_FILE="lsd-vVERSION-x86_64-apple-darwin.tar.gz"
        STARSHIP_FILE="starship-x86_64-apple-darwin.tar.gz"
        ZOXIDE_FILE="zoxide-VERSION-x86_64-apple-darwin.tar.gz"
        DUST_FILE="dust-vVERSION-x86_64-apple-darwin.tar.gz"
        DUF_FILE="duf_VERSION_darwin_amd64.tar.gz"
        BTM_FILE="bottom_x86_64-apple-darwin.tar.gz"
        JQ_FILE="jq-macos-amd64"
        CURLIE_FILE="curlie_VERSION_darwin_amd64.tar.gz"
        ;;
    *)
        echo "Unsupported architecture: $ARCH"
        exit 1
        ;;
esac

is_installed() {
    [[ -x "$INSTALL_DIR/$1" ]] && echo "${GREEN}installed${NC}" || echo "${DIM}not installed${NC}"
}

echo ""
echo -e "${BOLD}Binary Files Setup Guide${NC}"
echo -e "${DIM}Your system: macOS $ARCH_LABEL${NC}"
echo ""
echo -e "${CYAN}Tools & Download Info:${NC}"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

echo -e "${BOLD}fzf${NC} - Fuzzy finder [$(is_installed fzf)]"
echo -e "  GitHub: ${CYAN}https://github.com/junegunn/fzf/releases${NC}"
echo -e "  File:   $FZF_FILE"
echo -e "  Extract: ${DIM}unzip <file> && mv fzf $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}rg${NC} - ripgrep (fast grep) [$(is_installed rg)]"
echo -e "  GitHub: ${CYAN}https://github.com/BurntSushi/ripgrep/releases${NC}"
echo -e "  File:   $RG_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv */rg $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}fd${NC} - Fast file finder [$(is_installed fd)]"
echo -e "  GitHub: ${CYAN}https://github.com/sharkdp/fd/releases${NC}"
echo -e "  File:   $FD_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv */fd $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}bat${NC} - Cat with syntax highlighting [$(is_installed bat)]"
echo -e "  GitHub: ${CYAN}https://github.com/sharkdp/bat/releases${NC}"
echo -e "  File:   $BAT_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv */bat $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}lazygit${NC} - Terminal UI for git [$(is_installed lazygit)]"
echo -e "  GitHub: ${CYAN}https://github.com/jesseduffield/lazygit/releases${NC}"
echo -e "  File:   $LAZYGIT_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv lazygit $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}delta${NC} - Git diff viewer [$(is_installed delta)]"
echo -e "  GitHub: ${CYAN}https://github.com/dandavison/delta/releases${NC}"
echo -e "  File:   $DELTA_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv */delta $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}lsd${NC} - Modern ls replacement [$(is_installed lsd)]"
echo -e "  GitHub: ${CYAN}https://github.com/lsd-rs/lsd/releases${NC}"
echo -e "  File:   $LSD_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv */lsd $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}starship${NC} - Shell prompt [$(is_installed starship)]"
echo -e "  GitHub: ${CYAN}https://github.com/starship/starship/releases${NC}"
echo -e "  File:   $STARSHIP_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv starship $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}zoxide${NC} - Smart cd replacement [$(is_installed zoxide)]"
echo -e "  GitHub: ${CYAN}https://github.com/ajeetdsouza/zoxide/releases${NC}"
echo -e "  File:   $ZOXIDE_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv zoxide $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}dust${NC} - Better du (disk usage) [$(is_installed dust)]"
echo -e "  GitHub: ${CYAN}https://github.com/bootandy/dust/releases${NC}"
echo -e "  File:   $DUST_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv */dust $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}duf${NC} - Better df (disk free) [$(is_installed duf)]"
echo -e "  GitHub: ${CYAN}https://github.com/muesli/duf/releases${NC}"
echo -e "  File:   $DUF_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv duf $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}btm${NC} - Bottom (system monitor) [$(is_installed btm)]"
echo -e "  GitHub: ${CYAN}https://github.com/ClementTsang/bottom/releases${NC}"
echo -e "  File:   $BTM_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv btm $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}jq${NC} - JSON processor [$(is_installed jq)]"
echo -e "  GitHub: ${CYAN}https://github.com/jqlang/jq/releases${NC}"
echo -e "  File:   $JQ_FILE"
echo -e "  Extract: ${DIM}mv <file> $INSTALL_DIR/jq && chmod +x $INSTALL_DIR/jq${NC}"
echo ""

echo -e "${BOLD}lazydocker${NC} - Docker TUI [$(is_installed lazydocker)]"
echo -e "  GitHub: ${CYAN}https://github.com/jesseduffield/lazydocker/releases${NC}"
echo -e "  File:   $LAZYDOCKER_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv lazydocker $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}fx${NC} - Interactive JSON viewer [$(is_installed fx)]"
echo -e "  GitHub: ${CYAN}https://github.com/antonmedv/fx/releases${NC}"
echo -e "  File:   $FX_FILE"
echo -e "  Extract: ${DIM}mv <file> $INSTALL_DIR/fx && chmod +x $INSTALL_DIR/fx${NC}"
echo ""

echo -e "${BOLD}gron${NC} - Make JSON greppable [$(is_installed gron)]"
echo -e "  GitHub: ${CYAN}https://github.com/tomnomnom/gron/releases${NC}"
echo -e "  File:   $GRON_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv gron $INSTALL_DIR/${NC}"
echo ""

echo -e "${BOLD}curlie${NC} - curl with pretty output [$(is_installed curlie)]"
echo -e "  GitHub: ${CYAN}https://github.com/rs/curlie/releases${NC}"
echo -e "  File:   $CURLIE_FILE"
echo -e "  Extract: ${DIM}tar -xzf <file> && mv curlie $INSTALL_DIR/${NC}"
echo ""

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo -e "${BOLD}Steps:${NC}"
echo "  1. Visit GitHub releases page"
echo "  2. Download the file matching your architecture"
echo "  3. Extract and move binary to: $INSTALL_DIR"
echo "  4. Run: chmod +x <binary>"
echo ""
